<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèïÔ∏è ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô - ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&family=Courier+Prime:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        /* Apply Sarabun font for Thai text, Inter for others */
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            background-color: #f0f4f8;
            /* bg-slate-100 */
        }

        /* --- Base Styles --- */
        .validation-message {
            color: #e53e3e;
            /* Red-600 */
            font-size: 0.875rem;
            /* text-sm */
            margin-top: 0.25rem;
            /* mt-1 */
            min-height: 1.25rem;
            /* Ensure space even when empty */
            display: flex;
            align-items: center;
        }

        .validation-message>[data-lucide] {
            margin-right: 0.25rem;
            /* mr-1 */
            width: 1rem;
            /* w-4 */
            height: 1rem;
            /* h-4 */
            flex-shrink: 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 140px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 10;
            bottom: 150%;
            left: 50%;
            margin-left: -70px;
            /* Center the tooltip */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
            /* text-xs */
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        [data-lucide] {
            width: 1em;
            height: 1em;
            display: inline-block;
            vertical-align: middle;
            flex-shrink: 0;
        }

        /* --- Custom File Input --- */
        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
            display: none;
        }

        .custom-file-input::before {
            content: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
            display: inline-block;
            background: #4CAF50;
            /* Green */
            color: white;
            border-radius: 0.375rem;
            /* rounded-md */
            padding: 0.5rem 1rem;
            /* py-2 px-4 */
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            font-weight: 500;
            /* font-medium */
            font-size: 0.875rem;
            /* text-sm */
            transition: background-color 0.3s ease;
        }

        .custom-file-input:hover::before {
            background-color: #45a049;
        }

        .custom-file-input:active::before {
            background-color: #388e3c;
        }

        .custom-file-input:focus::before {
            /* Focus handled by container */
        }

        .file-input-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            /* gap-3 */
            border: 1px solid #d1d5db;
            /* border-gray-300 */
            padding: 0.25rem 0.25rem 0.25rem 0.5rem;
            /* Adjust padding */
            border-radius: 0.375rem;
            /* rounded-md */
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: white;
            /* Ensure background for contrast */
        }

        .file-input-container:has(input:focus) {
            border-color: #4CAF50;
            /* Green border */
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3);
            /* Green ring */
        }

        .file-name {
            font-size: 0.875rem;
            /* text-sm */
            color: #4a5568;
            /* text-gray-700 */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-grow: 1;
            padding-left: 0.5rem;
            /* Add some space before filename */
        }

        /* --- QR Code --- */
        #promptpay-qr-code {
            width: 180px;
            /* Fixed size */
            height: 180px;
            /* Fixed size */
            margin: 0 auto 0.5rem auto;
            /* Center horizontally */
            border: 1px solid #e2e8f0;
            /* border-slate-200 */
            padding: 5px;
            /* Small padding around QR */
            background-color: white;
            display: flex;
            /* Use flexbox for centering */
            align-items: center;
            justify-content: center;
        }

        #promptpay-qr-code img {
            display: block;
            width: 100% !important;
            height: 100% !important;
            object-fit: contain;
        }

        /* --- Fade Transitions --- */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.3s ease;
        }

        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }

        /* --- Receipt Styling --- */
        #receipt-box {
            background-color: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
            max-width: 420px;
            /* Slightly wider */
            margin-left: auto;
            margin-right: auto;
            opacity: 0;
            /* Hidden initially */
            transition: opacity 0.5s ease-in-out;
        }

        #receipt-box.visible {
            /* Added class for visibility control */
            opacity: 1;
        }

        .receipt-paper {
            font-family: 'Courier Prime', monospace;
            /* Monospace font for receipt */
            background-color: #fffff8;
            /* Off-white paper color */
            padding: 1.5rem 1.75rem;
            /* Increased padding slightly */
            border-radius: 5px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1), 0 2px 5px rgba(0, 0, 0, 0.08);
            /* Enhanced shadow */
            margin: 2rem auto 0;
            /* mt-8, centered */
            position: relative;
            overflow: hidden;
            /* Hide torn edge overflow */
            animation: slideUpFadeIn 0.6s ease-out forwards;
            /* Removed opacity/transform from here, handled by #receipt-box */
        }

        /* **** NEW: Receipt Header **** */
        .receipt-header {
            text-align: center;
            margin-bottom: 1.5rem;
            /* Increased space */
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }

        .receipt-header h2 {
            font-family: 'Sarabun', 'Inter', sans-serif;
            /* Use standard font for header */
            font-size: 1.25rem;
            /* text-xl */
            font-weight: 600;
            /* font-semibold */
            color: #1e3a8a;
            /* blue-800 */
            margin-bottom: 0.25rem;
        }

        .receipt-header p {
            font-size: 0.8rem;
            color: #6b7280;
            /* gray-500 */
        }

        /* **** END NEW **** */


        #receipt-content {
            font-size: 0.9rem;
            color: #333;
            /* Removed border/padding from here, handled by lines/dividers */
            margin-bottom: 1rem;
            /* mb-4 */
        }

        #receipt-content .receipt-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            /* Increased spacing slightly */
            line-height: 1.5;
            /* Improved readability */
        }

        #receipt-content .receipt-line span:first-child {
            color: #555;
            padding-right: 1rem;
            /* Space between label and value */
            flex-shrink: 0;
            /* Prevent label from shrinking */
        }

        #receipt-content .receipt-line span:last-child {
            text-align: right;
            font-weight: normal;
            /* Default weight for values */
            word-break: break-all;
            /* Break long words like ref */
        }

        #receipt-content .receipt-total {
            font-weight: 700;
            /* Bold */
            font-size: 1.1rem;
            /* Slightly larger */
            color: #000;
            margin-top: 1rem;
            /* Add space before total */
            padding-top: 0.75rem;
            /* Add padding above total */
            border-top: 1px dashed #aaa;
            /* Dashed line above total */
        }

        #receipt-content .receipt-ref {
            font-weight: 700;
            /* Bold */
            color: #1d4ed8;
            /* blue-700 */
            background-color: #eff6ff;
            /* blue-50 */
            padding: 0.1rem 0.4rem;
            border-radius: 3px;
            font-size: 0.85rem;
            /* Slightly smaller ref */
        }

        #receipt-content .receipt-status {
            text-align: center;
            font-weight: 700;
            /* Bold */
            color: #16a34a;
            /* Green-600 */
            margin-top: 1.5rem;
            /* Increased space */
            font-size: 1rem;
            letter-spacing: 1px;
            padding: 0.5rem;
            background-color: #f0fdf4;
            /* green-50 */
            border: 1px solid #bbf7d0;
            /* green-200 */
            border-radius: 4px;
        }

        #receipt-content hr.receipt-divider {
            border: none;
            border-top: 1px dashed #ccc;
            margin: 1rem 0;
            /* Increased margin */
        }

        .torn-edge {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 25px;
            /* Height of the effect */
            background: linear-gradient(to right bottom, transparent 50%, #fffff8 50%) 0 0 / 10px 10px repeat-x,
                linear-gradient(to left bottom, transparent 50%, #fffff8 50%) 0 0 / 10px 10px repeat-x;
            background-color: #f0f4f8;
            /* Match body background */
            mask: linear-gradient(-135deg, transparent 7px, white 7px) 0 0,
                linear-gradient(135deg, transparent 7px, white 7px) 0 0;
            mask-size: 14px 14px;
            mask-position: -7px 0;
        }

        @keyframes slideUpFadeIn {
            to {
                /* Animation now handled by #receipt-box visibility */
            }
        }

        /* **** UPDATED: Receipt Storage Note / Reminder **** */
        #receipt-reminder-note {
            /* Renamed ID for clarity */
            font-family: 'Sarabun', 'Inter', sans-serif;
            /* Use default font */
            font-size: 0.9rem;
            /* Increased size */
            color: #1e40af;
            /* blue-800 */
            text-align: center;
            margin-top: 1.5rem;
            /* mt-6 Increased space */
            padding: 1rem;
            /* p-4 Increased padding */
            background-color: #e0f2fe;
            /* sky-100 */
            border: 1px solid #7dd3fc;
            /* sky-300 */
            border-radius: 0.5rem;
            /* rounded-lg */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #receipt-reminder-note [data-lucide] {
            width: 1.1rem;
            height: 1.1rem;
            margin-right: 0.5rem;
            /* mr-2 */
            vertical-align: text-bottom;
            color: #0369a1;
            /* sky-700 */
        }

        #receipt-reminder-note strong {
            color: #0c4a6e;
            /* sky-900 */
        }

        /* **** END UPDATE **** */


        #receipt-buttons {
            margin-top: 1.5rem;
            /* Increased space */
            padding: 0 0 1.5rem;
            /* Remove horizontal padding, keep bottom */
        }

        /* Style for save button during saving */
        #save-receipt-btn.saving {
            opacity: 0.7;
            cursor: wait;
        }


        #selected-tier-info {
            font-size: 0.875rem;
            /* text-sm */
            color: #1d4ed8;
            /* blue-700 */
            background-color: #eff6ff;
            /* blue-50 */
            border: 1px solid #bfdbfe;
            /* blue-200 */
            padding: 0.5rem 0.75rem;
            /* py-2 px-3 */
            border-radius: 0.375rem;
            /* rounded-md */
            margin-top: -0.5rem;
            /* Pull it closer to guest input */
            margin-bottom: 1rem;
            /* mb-4 */
            text-align: center;
            transition: opacity 0.3s ease, transform 0.3s ease, height 0.3s ease;
            /* Added height transition */
            opacity: 0;
            /* Hidden by default */
            transform: translateY(-10px);
            height: 0;
            /* Collapse when hidden */
            overflow: hidden;
        }

        #selected-tier-info.visible {
            opacity: 1;
            transform: translateY(0);
            height: auto;
            /* Expand to content height */
            margin-top: -0.5rem;
            /* Keep negative margin */
            margin-bottom: 1rem;
            /* Keep bottom margin */
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            /* Smaller spinner */
            height: 24px;
            border-radius: 50%;
            border-left-color: #09f;
            /* Blue */
            animation: spin 1s ease infinite;
            display: inline-block;
            /* Make it inline */
            vertical-align: middle;
            /* Align with text */
            margin-right: 0.5rem;
            /* Add space */
        }

        /* Spinner variant for buttons */
        button .spinner {
            border-left-color: #fff;
            /* White spinner on dark buttons */
            width: 20px;
            height: 20px;
            border-width: 3px;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Simple alert box */
        .alert-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%) translateY(-20px);
            max-width: 90%;
            /* Ensure it fits on small screens */
        }

        .alert-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .alert-box-success {
            background-color: #dcfce7;
            /* green-100 */
            color: #166534;
            /* green-800 */
            border: 1px solid #86efac;
            /* green-300 */
        }

        .alert-box-error {
            background-color: #fee2e2;
            /* red-100 */
            color: #991b1b;
            /* red-800 */
            border: 1px solid #fecaca;
            /* red-300 */
        }

        .alert-box-info {
            background-color: #e0f2fe;
            /* sky-100 */
            color: #075985;
            /* sky-800 */
            border: 1px solid #bae6fd;
            /* sky-300 */
        }

        .alert-box [data-lucide] {
            margin-right: 0.5rem;
            flex-shrink: 0;
            /* Prevent icon shrinking */
        }

        .alert-box-close {
            margin-left: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            opacity: 0.7;
            padding: 0.25rem;
            /* Easier to click */
            line-height: 1;
            /* Prevent extra height */
        }

        .alert-box-close:hover {
            opacity: 1;
        }
    </style>
</head>

<body class="antialiased text-gray-800">
    <div class="container mx-auto px-4 py-8 max-w-2xl">

        <h1 class="text-3xl font-bold text-center mb-8 text-green-600 flex items-center justify-center">
            <span data-lucide="tent" class="w-8 h-8 mr-2"></span>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        </h1>

        <div id="payment-section"
            class="bg-white p-6 md:p-8 rounded-xl shadow-lg transition-opacity duration-300 ease-in-out">
            <h2 class="text-xl font-semibold mb-6 border-b pb-3 text-gray-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
            <div id="user-greeting" class="mb-4 text-sm text-gray-600"></div>
            <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="font-medium text-gray-700"><strong>‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å:</strong> <span
                        id="accommodation-name">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span></p>
            </div>
            <div class="mb-4">
                <label for="number-of-guests"
                    class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å:</label>
                <input type="number" id="number-of-guests" name="number_of_guests" min="1" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-150 ease-in-out"
                    placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô">
                <p id="guest-validation" class="validation-message"></p>
            </div>
            <div id="selected-tier-info">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å...
            </div>

            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-center">
                <p class="text-lg font-semibold text-blue-800">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</p>
                <p id="total-price" class="text-2xl font-bold text-blue-900">0 ‡∏ö‡∏≤‡∏ó</p>
                <p class="text-xs text-gray-500 mt-1">(‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á)</p>
            </div>

            <h2 class="text-xl font-semibold mb-4 border-b pb-3 text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
            <div class="mb-4">
                <label for="payment-method"
                    class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
                <select id="payment-method" name="payment_method" required
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-150 ease-in-out bg-white">
                    <option value="" selected disabled>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                    <option value="bank">‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</option>
                    <option value="promptpay">‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</option>
                </select>
                <p id="method-validation" class="validation-message"></p>
            </div>

            <div id="payment-method-details"
                class="mb-6 min-h-[250px] transition-opacity duration-300 ease-in-out opacity-0 flex items-center justify-center p-4 border border-gray-200 rounded-lg bg-gray-50">
                <p class="text-gray-400 text-sm italic">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
            </div>

            <div id="upload-section" class="mb-6 p-4 border border-dashed border-gray-300 rounded-lg bg-gray-50 hidden">
                <label for="payment-receipt"
                    class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
                <label class="file-input-container block w-full">
                    <input type="file" id="payment-receipt" name="payment_receipt"
                        accept="image/png, image/jpeg, image/gif, application/pdf" required
                        class="custom-file-input absolute w-[1px] h-[1px] opacity-0 overflow-hidden">
                    <span id="file-name-display" class="file-name">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                </label>
                <p id="file-validation" class="validation-message"></p>
            </div>

            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                <button type="button" id="submit-payment"
                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out flex items-center justify-center shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
                    <span data-lucide="check-circle" class="mr-2"></span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                </button>
                <button type="button" onclick="goBackOrHome();"
                    class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out flex items-center justify-center shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                    <span data-lucide="x-circle" class="mr-2"></span>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </div>

        <div id="receipt-box" class="">
            <div class="receipt-paper" id="receipt-paper-content">
                <div class="receipt-header">
                    <h2><span data-lucide="receipt-text" class="inline-block mr-2"></span>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô / ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                    </h2>
                    <p>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á‡∏™‡∏∏‡∏Ç‡πÉ‡∏à ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)</p>
                </div>
                <div id="receipt-content">
                </div>
                <div class="torn-edge"></div>
            </div>

            <div id="receipt-reminder-note">
            </div>
            <div id="receipt-buttons" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button type="button" id="save-receipt-btn"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center justify-center shadow focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span data-lucide="download" class="mr-2"></span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)
                </button>
                <button type="button" onclick="window.location.href='home.html';"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center justify-center shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    <span data-lucide="home" class="mr-2"></span>‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
            </div>
        </div>
    </div>

    <div id="alert-container"></div>

    <script>
        function saveBookingData(bookingData) {
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ bookingData ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!bookingData) {
    console.error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    return; // ‡∏´‡∏£‡∏∑‡∏≠ throw new Error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  }

  // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
  try {
    // ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ localStorage ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const bookingDataString = JSON.stringify(bookingData); // ‡πÅ‡∏õ‡∏•‡∏á Object ‡πÄ‡∏õ‡πá‡∏ô String
    localStorage.setItem('bookingData', bookingDataString); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô localStorage

    console.log("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß:", bookingData);
    // ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô:
    // alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
  } catch (error) {
    console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:", error);
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏£‡∏≤‡∏ö
    // alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
  }
}

// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
const sampleBookingData = {
  customerName: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
  roomType: "Deluxe",
  checkInDate: "2024-03-15",
  checkOutDate: "2024-03-17",
  numberOfGuests: 2,
  totalPrice: 2500,
  paymentMethod: "Credit Card"
};

saveBookingData(sampleBookingData); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á

// --- Full Accommodation Data ---
const allAccommodationsData = [
        // ... (Accommodation data remains the same as before) ...
        { id: 1, name: 'Hintok River Camp at Hellfire Pass ‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', description: '...', image: '...', priceTiers: [{ price: 1500, name: 'Standard Tent', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°'] }, { price: 2000, name: 'Deluxe Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-tree"></i> ‡∏ß‡∏¥‡∏ß‡∏™‡∏ß‡∏ô'] }, { price: 2500, name: 'Luxury Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-water"></i> ‡∏ß‡∏¥‡∏ß‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥', '<i class="fa-solid fa-mug-saucer"></i> ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤'] }] },
        { id: 2, name: 'Lalamukha Tented Resort ‡πÄ‡∏Ç‡∏≤‡πÉ‡∏´‡∏ç‡πà', description: '...', image: '...', priceTiers: [{ price: 2000, name: 'Eco Tent', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß'] }, { price: 2500, name: 'Deluxe Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-mountain-sun"></i> ‡∏ß‡∏¥‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤'] }, { price: 3000, name: 'Safari Suite', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-bath"></i> ‡∏≠‡πà‡∏≤‡∏á‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥', '<i class="fa-solid fa-mountain-sun"></i> ‡∏ß‡∏¥‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-champagne-glasses"></i> Welcome Drink'] }] },
        { id: 3, name: 'Mont Blanc Glamping Khao Yai ‡πÄ‡∏Ç‡∏≤‡πÉ‡∏´‡∏ç‡πà', description: '...', image: '...', priceTiers: [{ price: 1800, name: 'Garden View Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-seedling"></i> ‡∏ß‡∏¥‡∏ß‡∏™‡∏ß‡∏ô'] }, { price: 2200, name: 'Mountain View Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-mountain"></i> ‡∏ß‡∏¥‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤'] }, { price: 2600, name: 'Panoramic Suite Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-binoculars"></i> ‡∏ß‡∏¥‡∏ß‡∏û‡∏≤‡πÇ‡∏ô‡∏£‡∏≤‡∏°‡∏≤', '<i class="fa-solid fa-mug-saucer"></i> ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤'] }] },
        { id: 4, name: 'Jumptla Campiness ‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°', description: '...', image: '...', priceTiers: [{ price: 1200, name: 'River Breeze Tent', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°', '<i class="fa-solid fa-water"></i> ‡πÉ‡∏Å‡∏•‡πâ‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥'] }, { price: 1500, name: 'Cozy Tent', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß'] }, { price: 1800, name: 'Riverside Tent AC', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-water"></i> ‡∏£‡∏¥‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥'] }] },
        { id: 9, name: 'Te Mata Glamping ‡πÄ‡∏Ç‡∏≤‡πÉ‡∏´‡∏ç‡πà', description: '...', image: '...', priceTiers: [{ price: 8100, name: 'Grand Villa Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-bath"></i> ‡∏≠‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏∏‡∏ã‡∏ã‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-tv"></i> Smart TV', '<i class="fa-solid fa-utensils"></i> ‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å'] }, { price: 9000, name: 'Pool Villa Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-bath"></i> ‡∏≠‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏∏‡∏ã‡∏ã‡∏µ‡πà', '<i class="fa-solid fa-person-swimming"></i> ‡∏™‡∏£‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-wine-glass"></i> ‡∏°‡∏¥‡∏ô‡∏¥‡∏ö‡∏≤‡∏£‡πå'] }, { price: 9900, name: 'Royal Suite Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-bath"></i> ‡∏≠‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏∏‡∏ã‡∏ã‡∏µ‡πà', '<i class="fa-solid fa-person-swimming"></i> ‡∏™‡∏£‡∏∞‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà', '<i class="fa-solid fa-bell-concierge"></i> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Butler'] }] },
        { id: 5, name: 'River Tales ‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ', description: '...', image: '...', priceTiers: [{ price: 1700, name: 'Garden Camp', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°'] }, { price: 2100, name: 'Sweet Camp', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß'] }, { price: 2400, name: 'Onsen Camp', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-hot-tub-person"></i> ‡∏≠‡∏≠‡∏ô‡πÄ‡∏ã‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß'] }] },
        { id: 6, name: 'Social Camp ‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ', description: '...', image: '...', priceTiers: [{ price: 1900, name: 'Lotus View Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°', '<i class="fa-solid fa-leaf"></i> ‡∏ß‡∏¥‡∏ß‡∏ö‡∏∂‡∏á‡∏ö‡∏±‡∏ß'] }, { price: 2300, name: 'Field View Tent AC', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-tractor"></i> ‡∏ß‡∏¥‡∏ß‡∏ó‡∏∏‡πà‡∏á‡∏ô‡∏≤'] }, { price: 2700, name: 'Private Zone Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-shield-halved"></i> ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß'] }] },
        { id: 7, name: 'Slow Life Camping ‡∏™‡∏±‡∏ï‡∏´‡∏µ‡∏ö', description: '...', image: '...', priceTiers: [{ price: 1100, name: 'Beach Dome (Fan)', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°', '<i class="fa-solid fa-umbrella-beach"></i> ‡∏£‡∏¥‡∏°‡∏´‡∏≤‡∏î'] }, { price: 1400, name: 'Large Beach Dome', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°', '<i class="fa-solid fa-maximize"></i> ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà'] }, { price: 1700, name: 'Sea View Dome AC', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-water"></i> ‡∏ß‡∏¥‡∏ß‡∏ó‡∏∞‡πÄ‡∏•'] }] },
        { id: 8, name: 'The Birder‚Äôs Lodge ‡πÄ‡∏Ç‡∏≤‡πÉ‡∏´‡∏ç‡πà', description: '...', image: '...', priceTiers: [{ price: 1600, name: 'Lodge Tent', features: ['<i class="fa-solid fa-fan"></i> ‡∏û‡∏±‡∏î‡∏•‡∏°', '<i class="fa-solid fa-restroom"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏ß‡∏°'] }, { price: 2000, name: 'Cabin Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß'] }, { price: 2300, name: 'Suite Lodge Tent', features: ['<i class="fa-solid fa-snowflake"></i> ‡πÅ‡∏≠‡∏£‡πå', '<i class="fa-solid fa-shower"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ï‡∏±‡∏ß', '<i class="fa-solid fa-couch"></i> ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏•‡πà‡∏ô'] }] },
    ];

    // --- Constants and Global Variables ---
    const urlParams = new URLSearchParams(window.location.search);
    const accommodationIdParam = urlParams.get('id');
    let selectedAccommodation = null;
    let currentAccommodationTiers = [];
    let MAX_GUESTS_ALLOWED = 1;
    let currentUser = null;
    let qrCodeInstance = null;
    let isFormValid = { guests: false, method: false, file: false };
    let currentBookingRef = null;
    let currentSelectedTier = null;
    let currentTotalPrice = 0;
    let lastBookingData = null; // Store the data of the completed booking

    // --- Mock Data ---
    const bankDetails = { accountName: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á‡∏™‡∏∏‡∏Ç‡πÉ‡∏à ‡∏à‡∏≥‡∏Å‡∏±‡∏î", accountNumber: "123-4-56789-0", bankName: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û" };
    const promptpayDetails = { id: "081-234-5678" };

    // --- DOM Element References ---
    const nameElement = document.getElementById('accommodation-name');
    const guestsInput = document.getElementById('number-of-guests');
    const totalPriceElement = document.getElementById('total-price');
    const paymentMethodSelect = document.getElementById('payment-method');
    const paymentDetailsContainer = document.getElementById('payment-method-details');
    const uploadSection = document.getElementById('upload-section');
    const receiptInput = document.getElementById('payment-receipt');
    const fileNameDisplay = document.getElementById('file-name-display');
    const submitButton = document.getElementById('submit-payment');
    const paymentSection = document.getElementById('payment-section');
    const receiptBox = document.getElementById('receipt-box');
    const receiptPaperContent = document.getElementById('receipt-paper-content'); // Target for html2canvas
    const receiptContent = document.getElementById('receipt-content');
    const userGreetingElement = document.getElementById('user-greeting');
    const saveReceiptButton = document.getElementById('save-receipt-btn');
    const guestValidationMsg = document.getElementById('guest-validation');
    const methodValidationMsg = document.getElementById('method-validation');
    const fileValidationMsg = document.getElementById('file-validation');
    const receiptReminderNote = document.getElementById('receipt-reminder-note'); // Updated ID
    const selectedTierInfoElement = document.getElementById('selected-tier-info');
    const alertContainer = document.getElementById('alert-container');

    // --- Guest-to-Tier Mapping Logic ---
    const guestToTierIndexMap = (guestCount) => {
        if (!guestCount || guestCount <= 0) return -1;
        if (guestCount >= 1 && guestCount <= 2) return 0;
        if (guestCount >= 3 && guestCount <= 4) return 1;
        if (guestCount >= 5 && guestCount <= 6) return 2;
        return -1;
    };

    // --- Calculate Max Guests Allowed ---
    const calculateMaxGuests = (tiers) => {
        if (!tiers || tiers.length === 0) return 0;
        if (tiers.length >= 3 && guestToTierIndexMap(6) === 2) return 6;
        if (tiers.length >= 2 && guestToTierIndexMap(4) === 1) return 4;
        if (tiers.length >= 1 && guestToTierIndexMap(2) === 0) return 2;
        return 0;
    };

    // --- Utility Functions ---
    const formatCurrency = (amount) => {
        // Ensure amount is a number before formatting
        const numAmount = Number(amount);
        if (isNaN(numAmount)) {
            return 'N/A'; // Or some other placeholder for invalid numbers
        }
        return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', minimumFractionDigits: 0 }).format(numAmount);
    };
    const generateBookingReference = () => {
        return `BK-${Date.now().toString().slice(-6)}-${Math.random().toString(36).substring(2, 6).toUpperCase()}`;
    };
    const copyToClipboard = (text, element) => {
        navigator.clipboard.writeText(text).then(() => {
            showSimpleAlert(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å "${text}" ‡πÅ‡∏•‡πâ‡∏ß!`, 'success', 2000);
            if (element) {
                const originalIcon = element.innerHTML;
                element.innerHTML = `<span data-lucide="check" class="w-4 h-4 text-green-600"></span>`;
                lucide.createIcons();
                setTimeout(() => { element.innerHTML = originalIcon; lucide.createIcons(); }, 1500);
            }
        }).catch(err => {
            console.error('Could not copy text: ', err);
            showSimpleAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ', 'error');
        });
    };
    const showSimpleAlert = (message, type = 'info', duration = 3000) => {
        const alertId = `alert-${Date.now()}`;
        const alertDiv = document.createElement('div');
        alertDiv.id = alertId;
        alertDiv.className = `alert-box alert-box-${type}`;
        let icon = 'info';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'alert-circle';
        alertDiv.innerHTML = `
            <span data-lucide="${icon}"></span>
            <span>${message}</span>
            <button class="alert-box-close" onclick="closeAlert('${alertId}')" aria-label="‡∏õ‡∏¥‡∏î">&times;</button>
        `;
        alertContainer.appendChild(alertDiv);
        lucide.createIcons();
        requestAnimationFrame(() => { alertDiv.classList.add('show'); });
        if (duration) { setTimeout(() => { closeAlert(alertId); }, duration); }
    };
    const closeAlert = (alertId) => {
        const alertDiv = document.getElementById(alertId);
        if (alertDiv) {
            alertDiv.classList.remove('show');
            alertDiv.addEventListener('transitionend', () => alertDiv.remove(), { once: true });
            setTimeout(() => { if (alertDiv && alertDiv.parentNode) { alertDiv.remove(); } }, 500);
        }
    };
    const showValidationMessage = (element, message) => {
        element.innerHTML = `<span data-lucide="alert-circle"></span> ${message}`;
        lucide.createIcons({ nodes: [element.querySelector('[data-lucide]')] });
    };
    const clearValidationMessage = (element) => { element.innerHTML = ''; };

    // --- Event Handlers ---
    function handleGuestInput() {
        const guestCount = parseInt(guestsInput.value, 10);
        let isValid = false;
        currentSelectedTier = null;
        currentTotalPrice = 0;
        clearValidationMessage(guestValidationMsg);
        selectedTierInfoElement.classList.remove('visible');

        if (!guestCount || guestCount <= 0) {
            showValidationMessage(guestValidationMsg, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å');
        } else if (guestCount > MAX_GUESTS_ALLOWED) {
            showValidationMessage(guestValidationMsg, `‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${MAX_GUESTS_ALLOWED} ‡∏Ñ‡∏ô`);
        } else {
            const tierIndex = guestToTierIndexMap(guestCount);
            if (tierIndex !== -1 && tierIndex < currentAccommodationTiers.length) {
                currentSelectedTier = currentAccommodationTiers[tierIndex];
                currentTotalPrice = currentSelectedTier.price;
                isValid = true;
                selectedTierInfoElement.innerHTML = `
                    <span data-lucide="check" class="inline-block w-4 h-4 mr-1"></span>
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <strong>${currentSelectedTier.name}</strong> (${formatCurrency(currentTotalPrice)})
                    <div class="text-xs mt-1 text-gray-600">${currentSelectedTier.features.join(' &bull; ')}</div>
                `;
                lucide.createIcons({ nodes: [selectedTierInfoElement.querySelector('[data-lucide]')] });
                selectedTierInfoElement.classList.add('visible');
            } else {
                showValidationMessage(guestValidationMsg, '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏µ‡πâ');
                selectedTierInfoElement.classList.remove('visible');
            }
        }
        totalPriceElement.textContent = formatCurrency(currentTotalPrice);
        isFormValid.guests = isValid;
        updateSubmitButtonState();
        // Regenerate QR if needed
        if (paymentMethodSelect.value === 'promptpay') {
            generateQRCode(currentTotalPrice);
        }
    }
    function handlePaymentMethodChange() {
        const selectedMethod = paymentMethodSelect.value;
        isFormValid.method = !!selectedMethod;
        clearValidationMessage(methodValidationMsg);
        if (!selectedMethod) {
            showValidationMessage(methodValidationMsg, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
        }
        displayPaymentDetails(selectedMethod);
        updateSubmitButtonState();
    }
    function handleFileSelect() {
        const file = receiptInput.files[0];
        let isValid = false;
        clearValidationMessage(fileValidationMsg);
        if (file) {
            const allowedTypes = ['image/png', 'image/jpeg', 'image/gif', 'application/pdf'];
            if (allowedTypes.includes(file.type)) {
                fileNameDisplay.textContent = file.name;
                fileNameDisplay.classList.remove('text-gray-400', 'italic', 'text-red-600');
                isValid = true;
            } else {
                fileNameDisplay.textContent = '‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠ PDF)';
                fileNameDisplay.classList.add('text-red-600');
                showValidationMessage(fileValidationMsg, '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå PNG, JPG, GIF, PDF');
            }
        } else {
            fileNameDisplay.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
            fileNameDisplay.classList.add('text-gray-400', 'italic');
            showValidationMessage(fileValidationMsg, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');
        }
        isFormValid.file = isValid;
        updateSubmitButtonState();
    }
    async function handleSubmitPayment() {
        if (!isFormValid.guests || !isFormValid.method || (paymentMethodSelect.value === 'bank' && !isFormValid.file)) {
            showSimpleAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            return;
        }
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';

        await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate processing

        currentBookingRef = generateBookingReference();
        lastBookingData = { // Store data for receipt generation and saving
            ref: currentBookingRef,
            accommodationId: selectedAccommodation.id,
            accommodationName: selectedAccommodation.name,
            guestCount: parseInt(guestsInput.value, 10),
            tierName: currentSelectedTier.name,
            totalPrice: currentTotalPrice,
            paymentMethod: paymentMethodSelect.options[paymentMethodSelect.selectedIndex].text,
            paymentTimestamp: new Date().toISOString(),
            user: currentUser ? currentUser.username : 'Guest',
            receiptFileName: receiptInput.files[0]?.name || null
        };

        try {
            const bookings = JSON.parse(localStorage.getItem('glampingBookings') || '[]');
            bookings.push(lastBookingData);
            localStorage.setItem('glampingBookings', JSON.stringify(bookings));

            showSimpleAlert('‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');

            // Transition to receipt view
            paymentSection.style.opacity = '0';
            setTimeout(async () => { // Make async for auto-save
                paymentSection.classList.add('hidden');
                displayReceipt(lastBookingData); // Display the receipt first
                receiptBox.classList.add('visible'); // Make receipt box visible

                // **** ADDED: Attempt automatic save ****
                try {
                    await handleSaveReceipt(true); // Pass true for automatic mode
                    showSimpleAlert('‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', 'info', 4000);
                } catch (saveError) {
                    console.warn("Automatic receipt save failed:", saveError);
                    showSimpleAlert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'info', 5000);
                }
                // **** END ADDED ****

            }, 300);

        } catch (error) {
            console.error("Error saving booking:", error);
            showSimpleAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            submitButton.disabled = false;
            submitButton.innerHTML = '<span data-lucide="check-circle" class="mr-2"></span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
            lucide.createIcons();
        }
    }

    // **** UPDATED: handleSaveReceipt function ****
    async function handleSaveReceipt(isAuto = false) { // Added isAuto flag
        if (!lastBookingData || !receiptPaperContent) {
            showSimpleAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
            return Promise.reject('Missing receipt data or element'); // Return a rejected promise for async handling
        }

        const buttonText = isAuto ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        const originalButtonContent = saveReceiptButton.innerHTML;

        saveReceiptButton.disabled = true;
        saveReceiptButton.classList.add('saving');
        saveReceiptButton.innerHTML = `<span class="spinner"></span> ${buttonText}`;

        try {
            // Use html2canvas to capture the receipt element
            const canvas = await html2canvas(receiptPaperContent, {
                scale: 2, // Increase scale for better resolution
                useCORS: true, // Important if using external images/fonts, though maybe not needed here
                backgroundColor: '#fffff8' // Ensure background color is captured
            });

            // Convert canvas to PNG data URL
            const imageDataUrl = canvas.toDataURL('image/png');

            // Create a temporary link to trigger download
            const link = document.createElement('a');
            link.href = imageDataUrl;
            // Create filename: ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à-REF-Date.png
            const dateStr = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
            link.download = `‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à-${lastBookingData.ref}-${dateStr}.png`;

            // Trigger downloaddocument.body.appendChild(link); // Required for Firefox
            link.click();
            document.body.removeChild(link);

            if (!isAuto) { // Show success only for manual click
                showSimpleAlert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (PNG) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }
            saveReceiptButton.innerHTML = '<span data-lucide="check" class="mr-2"></span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
            lucide.createIcons();
            // Keep button disabled briefly after success
            setTimeout(() => {
                saveReceiptButton.disabled = false;
                saveReceiptButton.classList.remove('saving');
                saveReceiptButton.innerHTML = originalButtonContent; // Restore original content
                lucide.createIcons();
            }, 2000);

            return Promise.resolve(); // Indicate success

        } catch (error) {
            console.error("Error generating receipt image:", error);
            showSimpleAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à', 'error');
            saveReceiptButton.disabled = false;
            saveReceiptButton.classList.remove('saving');
            saveReceiptButton.innerHTML = originalButtonContent; // Restore original content
            lucide.createIcons();
            return Promise.reject(error); // Indicate failure
        }
    }
    // **** END UPDATE ****

    // --- UI Update Functions ---
    function displayPaymentDetails(method) {
        paymentDetailsContainer.innerHTML = '';
        paymentDetailsContainer.style.opacity = '0';
        uploadSection.classList.add('hidden');
        isFormValid.file = true; // Assume not needed unless bank

        if (method === 'bank') {
            paymentDetailsContainer.innerHTML = `
                <div class="text-sm text-left w-full space-y-3">
                    <p class="font-semibold text-gray-700">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</p>
                    <div class="flex justify-between items-center">
                        <span>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</span>
                        <span class="font-medium text-gray-900">${bankDetails.accountName}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</span>
                        <span class="font-medium text-gray-900">${bankDetails.bankName}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</span>
                        <button class="font-mono font-semibold text-blue-600 flex items-center group" onclick="copyToClipboard('${bankDetails.accountNumber}', this)">
                            ${bankDetails.accountNumber}
                            <span data-lucide="copy" class="ml-2 w-4 h-4 text-gray-400 group-hover:text-blue-600"></span>
                        </button>
                    </div>
                    <p class="text-xs text-red-600 mt-3 bg-red-50 p-2 rounded border border-red-200">
                        <span data-lucide="alert-triangle" class="w-4 h-4 inline-block mr-1"></span>
                        <strong>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
                    </p>
                </div>`;
            uploadSection.classList.remove('hidden');
            isFormValid.file = !!receiptInput.files[0]; // Re-validate
        } else if (method === 'promptpay') {
            paymentDetailsContainer.innerHTML = `
                <div class="text-center w-full">
                    <p class="font-semibold text-gray-700 mb-2">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</p>
                    <div id="promptpay-qr-code" class="mb-2 bg-white p-1 border rounded">
                       <div class="spinner"></div>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">
                        ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà PromptPay ID:
                        <button class="font-mono font-semibold text-blue-600 inline-flex items-center group" onclick="copyToClipboard('${promptpayDetails.id}', this)">
                            ${promptpayDetails.id}
                            <span data-lucide="copy" class="ml-1 w-4 h-4 text-gray-400 group-hover:text-blue-600"></span>
                        </button>
                    </p>
                    <p class="text-xs text-gray-500">(‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ)</p>
                </div>`;
            setTimeout(() => generateQRCode(currentTotalPrice), 50);
        } else {
            paymentDetailsContainer.innerHTML = '<p class="text-gray-400 text-sm italic">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>';
        }
        lucide.createIcons({ context: paymentDetailsContainer });
        requestAnimationFrame(() => { paymentDetailsContainer.style.opacity = '1'; });
        updateSubmitButtonState();
    }
    function generateQRCode(amount) {
        const qrElement = document.getElementById('promptpay-qr-code');
        if (!qrElement) return;
        qrElement.innerHTML = ''; // Clear previous

        if (amount <= 0 || !selectedAccommodation || isNaN(Number(amount))) { // Added NaN check
            qrElement.innerHTML = '<p class="text-xs text-red-500 p-4">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</p>';
            return;
        }
        const PAYLOAD_FORMAT = '000201';
        const POI_METHOD = '010212';
        const MERCHANT_INFO_AID = '29370016A000000677010111';
        const PROMPTPAY_ID = promptpayDetails.id.replace(/-/g, '');
        const MERCHANT_INFO_TYPE = PROMPTPAY_ID.length >= 15 ? '03' : (PROMPTPAY_ID.length >= 13 ? '02' : '01');
        const MERCHANT_INFO_ID = `${MERCHANT_INFO_TYPE}${PROMPTPAY_ID.length.toString().padStart(2, '0')}${PROMPTPAY_ID}`;
        const MERCHANT_INFO = `${MERCHANT_INFO_AID}${MERCHANT_INFO_ID}`;
        const COUNTRY_CODE = '5802TH';
        const CURRENCY_CODE = '5303764';
        const AMOUNT_STR = amount.toFixed(2); // Ensure 2 decimal places for calculation
        const AMOUNT = `54${AMOUNT_STR.length.toString().padStart(2, '0')}${AMOUNT_STR}`;
        let payload = `${PAYLOAD_FORMAT}${POI_METHOD}${MERCHANT_INFO}${COUNTRY_CODE}${CURRENCY_CODE}${AMOUNT}`;
        function crc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                crc ^= data.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
                }
            }
            return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
        }
        const CRC_FIELD = `6304${crc16(payload + '6304')}`;
        payload += CRC_FIELD;

        try {
            qrCodeInstance = new QRCode(qrElement, {
                text: payload,
                width: 170, height: 170,
                colorDark: "#000000", colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.M
            });
        } catch (error) {
            console.error("Error generating QR Code:", error);
            qrElement.innerHTML = '<p class="text-xs text-red-500 p-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</p>';
        }
    }
    function updateSubmitButtonState() {
        const isBankTransfer = paymentMethodSelect.value === 'bank';
        const fileNeededAndValid = !isBankTransfer || (isBankTransfer && isFormValid.file);
        submitButton.disabled = !(isFormValid.guests && isFormValid.method && fileNeededAndValid);
    }
    function displayReceipt(data) {
        const paymentDate = new Date(data.paymentTimestamp);
        const formattedDate = paymentDate.toLocaleDateString('th-TH', { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });

        receiptContent.innerHTML = `
            <div class="receipt-line"><span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span> <span>${formattedDate} ‡∏ô.</span></div>
            <div class="receipt-line"><span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</span> <span class="receipt-ref">${data.ref}</span></div>
            <hr class="receipt-divider">
            <div class="receipt-line"><span>‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</span> <span>${data.user}</span></div>
            <div class="receipt-line"><span>‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å:</span> <span>${data.accommodationName}</span></div>
            <div class="receipt-line"><span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span> <span>${data.tierName}</span></div>
            <div class="receipt-line"><span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å:</span> <span>${data.guestCount} ‡∏Ñ‡∏ô</span></div>
            <div class="receipt-line"><span>‡∏ä‡∏≥‡∏£‡∏∞‡πÇ‡∏î‡∏¢:</span> <span>${data.paymentMethod}</span></div>
            ${data.receiptFileName ? `<div class="receipt-line"><span>‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö:</span> <span class="text-xs truncate" title="${data.receiptFileName}">${data.receiptFileName}</span></div>` : ''}
            <div class="receipt-line receipt-total"><span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span> <span>${formatCurrency(data.totalPrice)}</span></div>
            <div class="receipt-status">*** ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ***</div>
        `;

        // **** UPDATED: Reminder Note Content ****
        receiptReminderNote.innerHTML = `
            <span data-lucide="party-popper" class="inline-block"></span>
            <strong>‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!</strong> ‡πÇ‡∏õ‡∏£‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ô‡∏µ‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î) ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á ‡∏ì ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        `;
        lucide.createIcons({ context: receiptReminderNote }); // Render icon
    }

    // --- Authentication and Initialization ---
    function checkLoginStatus() {
        const storedUser = localStorage.getItem('glampingUser');
        if (storedUser) {
            currentUser = JSON.parse(storedUser);
            userGreetingElement.innerHTML = `<span data-lucide="user" class="inline-block w-4 h-4 mr-1"></span> ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, <strong>${currentUser.username}</strong>!`;
            lucide.createIcons({ nodes: [userGreetingElement.querySelector('[data-lucide]')] });
        } else {
            userGreetingElement.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
        }
    }

    function initializePage() {
        checkLoginStatus();
        if (!accommodationIdParam) {
            window.location.href = 'home.html';
            return;
        }

        selectedAccommodation = allAccommodationsData.find(acc => acc.id === parseInt(accommodationIdParam, 10));
        if (!selectedAccommodation) {
            window.location.href = 'dashboard.html';
            return;
        }

        currentAccommodationTiers = selectedAccommodation.priceTiers;
        MAX_GUESTS_ALLOWED = calculateMaxGuests(currentAccommodationTiers);

        nameElement.textContent = selectedAccommodation.name;
        document.title = `‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å ${selectedAccommodation.name} - Glamping.com`;

        guestsInput.addEventListener('input', handleGuestInput);
        paymentMethodSelect.addEventListener('change', handlePaymentMethodChange);
        receiptInput.addEventListener('change', handleFileSelect);
        submitButton.addEventListener('click', handleSubmitPayment);
        saveReceiptButton.addEventListener('click', handleSaveReceipt); // **** ADDED ****

        displayPaymentDetails(paymentMethodSelect.value); // Initial display
        handleGuestInput(); // Initial guest check
    }

    // --- Initialize ---
    document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>